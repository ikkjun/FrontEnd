<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card Game</title>
  <style>
    img {
      width : 80px;
      height : 120px;
    }
  </style>
</head>
<body>
  <button id="hide">뒤집기</button>
  <button id="show">보이기</button>
  <button id="shuffle">섞기</button><br>
  <!-- <img src="0.png" alt=""><img src="1.png" alt=""><img src="2.png" alt=""><img src="3.png" alt=""><img src="4.png" alt=""><img src="5.png" alt=""><img src="6.png" alt=""><img src="7.png" alt=""><img src="8.png" alt=""><img src="9.png" alt=""><img src="10.png" alt=""><img src="11.png" alt=""><img src="12.png" alt=""><img src="13.png" alt=""><img src="14.png" alt=""><img src="15.png" alt=""><img src="16.png" alt=""><img src="17.png" alt=""><img src="18.png" alt=""><img src="19.png" alt=""><img src="20.png" alt=""><img src="21.png" alt=""><img src="22.png" alt=""><img src="23.png" alt=""><img src="24.png" alt=""><img src="25.png" alt=""><img src="26.png" alt=""><img src="27.png" alt=""><img src="28.png" alt=""><img src="29.png" alt=""><img src="30.png" alt=""><img src="31.png" alt=""><img src="32.png" alt=""><img src="33.png" alt=""><img src="34.png" alt=""><img src="35.png" alt=""><img src="36.png" alt=""><img src="37.png" alt=""><img src="38.png" alt=""><img src="39.png" alt=""><img src="40.png" alt=""><img src="41.png" alt=""><img src="42.png" alt=""><img src="43.png" alt=""><img src="44.png" alt=""><img src="45.png" alt=""><img src="46.png" alt=""><img src="47.png" alt=""><img src="48.png" alt=""><img src="49.png" alt=""><img src="50.png" alt=""><img src="51.png" alt=""> -->
  <div id="board">
  </div>
  <script>
    let cardArr = [];

    window.onload = function() {
      // 버튼 참조 가져오기
      let hide = document.getElementById("hide");
      let show = document.getElementById("show");
      let shuffle = document.getElementById("shuffle");
      // board 태그 가져오기
      let board = document.getElementById("board");
      // img 태그 가져오기
      let images = document.getElementsByTagName("img");

      // 1. 배열 초기화
      initializeCard();

      // 2. 버튼에 이벤트 등록
      hide.addEventListener('click', flipAllCards);
      show.addEventListener("click", showCard);
      shuffle.addEventListener("click",shuffleCard);

      // 3. 카드에 이벤트 등록
      for(let i=0;i<images.length;i++) {
        images[i].addEventListener("click",cardClick);
      }
    }

    // 카드 초기화
    const Pattern = {
      DIAMOND : "diamond",
      CLOVER : "clover",
      HEART : "heart",
      SPADE : "spade",
    };
    const NUM = {
      ONE:"1",
      TWO:"2",
      THREE:"3",
      FOUR:"4",
      FIVE:"5",
      SIX:"6",
      SEVEN:"7",
      EIGHT:"8",
      NINE:"9",
      TEN:"10",
      ELEVEN:"11",
      TWELEVE:"12",
      THIRTEEN:"13"
    };

    function initializeCard() {
      let idx = 0
      for(p in Pattern) {
        for (n in NUM) {
          // 인덱스 번호
          // 카드 생성자
          cardArr.push(new Card(p,n, idx++));
        }
      }
      
      idx = 0
      for(p in Pattern) {
        for (n in NUM) {
          
          // 인덱스 번호
          // 카드 생성자
          cardArr.push(new Card(p,n, idx++));
        }
      }

      for(let i=0 ; i<cardArr.length ; i++) {
        let img = document.createElement('img');
        img.setAttribute("src", cardArr[i].getIndex() + ".png");
        board.appendChild(img);
      }
    }

    function Card(p, n, idx) {
      let pattern = p;
      let num = n;
      let index = idx;
      this.getPattern = function () {
        return Pattern[pattern];
      };

      this.getNum = function () {
        return NUM[num];
      }

      this.getIndex = function() {
        return index;
      }
    }

    function cardClick(event) {
      // 1. 카드가 앞면인지 확인. 앞면이면 return
      let card = event.target;
      if(isFront(card)) return;
      flip(card);
      // 3. 두 번째 카드면 첫 번째 카드와 비교 image 태그 가져와서 back아닌것 2개
      //    첫 번째 카드면 비교할 필요가 없다. return
    }

    function flip(card) {
      // 해당되는 배열에 getIndex 사용해서 그림 보여주기
      alert(card.getAttribute("src"));
    }

    // 카드가 앞면이면 true, 아니면 false
    function isFront(card) {
      let src = card.getAttribute("src");
      if(src.indexOf('back') !== -1) {
        return false; // 앞면
      } else {
        return true;  // 뒷면
      }
    }

    // 모든 카드를 뒤집는 함수. 
    function flipAllCards() {
      let image = document.getElementsByTagName("img");
      for (let i=0;i<image.length;i++) {
        image[i].setAttribute("src","back.png")
      }
    }

    // 카드를 보여주는 함수
    function showCard() {
      let image = document.getElementsByTagName("img");
      for (let i=0;i<image.length;i++) {
        image[i].setAttribute("src", cardArr[i].getIndex() + ".png");
      }
    }

    // 카드를 섞는 함수
    function shuffleCard() {
      cardArr.sort((a,b) => Math.random() - 0.5);
      let board = document.getElementById("board");
      let image = document.getElementsByTagName("img");
      for(let i=image.length-1; i>=0;i--) {
        board.removeChild(image[i]);
      }
      for(let i=0 ; i<cardArr.length ; i++) {
        let img = document.createElement('img');
        img.setAttribute("src", cardArr[i].getIndex() + ".png");
        board.appendChild(img);
      }
    }
  </script>
</body>
</html>